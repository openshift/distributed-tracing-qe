# OpenTelemetry Component End-to-End Test Suite

This directory contains comprehensive end-to-end tests for OpenTelemetry Collector components, providing **configuration blueprints** and **testing patterns** for customers to understand and deploy various OpenTelemetry receivers, processors, exporters, and extensions.

> **üìù Note**: The component README files in this directory were generated by Claude AI to provide comprehensive documentation and configuration examples based on the existing test cases.

## üéØ Purpose

These test scenarios provide OpenTelemetry component configuration blueprints that demonstrate:
- Individual component functionality and configuration
- Real-world deployment patterns for specific use cases
- Integration testing with Kubernetes and OpenShift
- Configuration examples for component setup and optimization

## üìã Component Test Categories

### üîÑ Receivers
| Component | Purpose | Key Features |
|-----------|---------|-------------|
| [filelog](./filelog/) | File-based Log Collection | Pod log collection, file parsing, daemonset deployment |
| [hostmetricsreceiver](./hostmetricsreceiver/) | Host System Metrics | CPU, memory, disk, network metrics from nodes |
| [k8sclusterreceiver](./k8sclusterreceiver/) | Kubernetes Cluster Metrics | Cluster-wide metrics, pod/node status, resource usage |
| [k8seventsreceiver](./k8seventsreceiver/) | Kubernetes Events | Event collection, cluster monitoring, troubleshooting |
| [kubeletstatsreceiver](./kubeletstatsreceiver/) | Kubelet Statistics | Container metrics, pod resource usage, node stats |
| [k8sobjectsreceiver](./k8sobjectsreceiver/) | Kubernetes Object Monitoring | Custom resource monitoring, object state tracking |
| [journaldreceiver](./journaldreceiver/) | systemd Journal Logs | System log collection, journal parsing, node-level logs |
| [otlpjsonfilereceiver](./otlpjsonfilereceiver/) | OTLP JSON File Input | File-based OTLP data ingestion, batch processing |
| [prometheusremotewritereceiver](./prometheusremotewritereceiver/) | Prometheus Remote Write v2 intake | Accepts RW v2 from OTel exporter; v2-only |

### üîß Processors
| Component | Purpose | Key Features |
|-----------|---------|-------------|
| [transformprocessor](./transformprocessor/) | Data Transformation | Field mapping, data enrichment, format conversion |
| [filterprocessor](./filterprocessor/) | Data Filtering | Selective data processing, noise reduction, cost optimization |
| [groupbyattrsprocessor](./groupbyattrsprocessor/) | Attribute Grouping | Data aggregation, resource optimization, cardinality reduction |
| [tailsamplingprocessor](./tailsamplingprocessor/) | Intelligent Sampling | Trace-based sampling, performance optimization, cost control |

### üì§ Exporters
| Component | Purpose | Key Features |
|-----------|---------|-------------|
| [prometheusremotewriteexporter](./prometheusremotewriteexporter/) | Prometheus Integration | Remote write protocol, metrics export, monitoring integration |
| [awsxrayexporter](./awsxrayexporter/) | AWS X-Ray Integration | Distributed tracing, AWS cloud integration, service maps |
| [awscloudwatchlogsexporter](./awscloudwatchlogsexporter/) | AWS CloudWatch Logs | Log aggregation, AWS cloud logging, centralized monitoring |
| [loadbalancingexporter](./loadbalancingexporter/) | Load Balanced Export | High availability, traffic distribution, resilient telemetry |
| [googlemanagedprometheus](./googlemanagedprometheus/) | Google Cloud Monitoring | GCP integration, managed Prometheus, cloud-native monitoring |

### üîó Connectors
| Component | Purpose | Key Features |
|-----------|---------|-------------|
| [routingconnector](./routingconnector/) | Data Routing | Conditional routing, multi-destination, intelligent forwarding |
| [forwardconnector](./forwardconnector/) | Data Forwarding | Pipeline chaining, data flow control, routing flexibility |
| [countconnector](./countconnector/) | Metric Generation | Data counting, statistics generation, monitoring insights |

### üîå Extensions
| Component | Purpose | Key Features |
|-----------|---------|-------------|
| [oidcauthextension](./oidcauthextension/) | OIDC Authentication | Secure authentication, identity integration, access control |
| [filestorageext](./filestorageext/) | File-based Storage | Persistent queuing, data buffering, reliability enhancement |

### üî¨ Signal Support (Tech Preview)
| Component | Purpose | Key Features |
|-----------|---------|-------------|
| [profilesignal](./profilesignal/) | Profiles Signal Support | Feature gate validation, pipeline configuration, collector readiness |

## üöÄ Quick Start

### Prerequisites

- Kubernetes or OpenShift cluster
- OpenTelemetry Operator installed
- `kubectl` or `oc` CLI tool configured
- [Chainsaw](https://kyverno.github.io/chainsaw/) for running tests

### Running Tests

```bash
# Run all component tests
chainsaw test --test-dir tests/e2e-otel/

# Run specific component test
chainsaw test --test-dir tests/e2e-otel/filelog/

# Run tests with specific configuration
chainsaw test --test-dir tests/e2e-otel/k8sclusterreceiver/ --config chainsaw-config.yaml
```

### Using as Configuration Templates

Each test directory contains:
- **Production-ready configurations**: YAML manifests for real deployments
- **Test scenarios**: Validation and verification examples
- **Documentation**: Component-specific usage guidance
- **Scripts**: Automated verification and helper tools

## üèóÔ∏è Test Structure

Each component test follows a consistent structure:

```
component-name/
‚îú‚îÄ‚îÄ README.md                           # Component-specific documentation
‚îú‚îÄ‚îÄ chainsaw-test.yaml                  # Chainsaw test definition
‚îú‚îÄ‚îÄ otel-collector.yaml                 # OpenTelemetry Collector configuration
‚îú‚îÄ‚îÄ otel-collector-assert.yaml          # Test assertions
‚îú‚îÄ‚îÄ check_logs.sh                       # Verification script
‚îú‚îÄ‚îÄ additional-resources.yaml           # Supporting resources
‚îî‚îÄ‚îÄ additional-resources-assert.yaml    # Resource assertions
```

## üîß Configuration Patterns

### Common Component Configurations

1. **RBAC Setup**
   - Service accounts and permissions
   - Cluster roles for cross-namespace access
   - Security context constraints for OpenShift

2. **Resource Management**
   - CPU and memory limits
   - Storage configurations
   - Network policies

3. **Data Processing**
   - Input validation and parsing
   - Transformation and enrichment
   - Output formatting and routing

4. **Monitoring Integration**
   - Health checks and status monitoring
   - Performance metrics collection
   - Alerting and notification setup

### Prometheus Remote Write v2 (Important)

The Prometheus Remote Write receiver only accepts v2. To send v2 from the OpenTelemetry Collector `prometheusremotewrite` exporter, ensure:

- Enable the feature gate on the sender collector:
  - args.feature-gates: `exporter.prometheusremotewritexporter.enableSendingRW2`
  - or via CLI flag: `--feature-gates=exporter.prometheusremotewritexporter.enableSendingRW2`
- Use the v2 protobuf message on the exporter:
  - `protobuf_message: "io.prometheus.write.v2.Request"`

See `tests/e2e-otel/prometheusremotewritereceiver/otel-collector-sender.yaml` for a working example.

## üìä Component Categories by Use Case

### üìà Metrics Collection
- **Infrastructure**: `hostmetricsreceiver`, `kubeletstatsreceiver`
- **Application**: `k8sclusterreceiver`, `k8sobjectsreceiver`
- **Export**: `prometheusremotewriteexporter`, `googlemanagedprometheus`

### üìù Log Management
- **Collection**: `filelog`, `journaldreceiver`
- **Processing**: `transformprocessor`, `filterprocessor`
- **Export**: `awscloudwatchlogsexporter`

### üîç Distributed Tracing
- **Collection**: `otlpjsonfilereceiver`
- **Processing**: `tailsamplingprocessor`, `groupbyattrsprocessor`
- **Export**: `awsxrayexporter`, `loadbalancingexporter`

### üîÑ Data Pipeline
- **Routing**: `routingconnector`, `forwardconnector`
- **Transformation**: `transformprocessor`
- **Reliability**: `filestorageext`, `loadbalancingexporter`

## üõ°Ô∏è Security and Authentication

Components with security features:
- **Authentication**: `oidcauthextension`
- **Access Control**: RBAC configurations in receiver components
- **Secure Communication**: TLS configurations in exporter components

## üìö Learning Path

### Beginner
1. Start with basic receivers: `hostmetricsreceiver`, `filelog`
2. Learn filtering and transformation: `filterprocessor`, `transformprocessor`
3. Explore simple exporters: `prometheusremotewriteexporter`

### Intermediate
1. Kubernetes integration: `k8sclusterreceiver`, `k8seventsreceiver`
2. Advanced processing: `tailsamplingprocessor`, `groupbyattrsprocessor`
3. Load balancing and routing: `loadbalancingexporter`, `routingconnector`

### Advanced
1. Cloud integrations: `awsxrayexporter`, `googlemanagedprometheus`
2. Authentication and security: `oidcauthextension`
3. Custom data flows: `forwardconnector`, `countconnector`

## üîç Testing and Validation

Each component test includes:
- **Functional validation**: Component operation verification
- **Data flow testing**: Input/output validation
- **Performance testing**: Resource usage monitoring
- **Integration testing**: Multi-component scenarios

## ü§ù Contributing

When adding new component tests:
1. Follow the established directory structure
2. Include comprehensive README documentation
3. Provide example configurations
4. Add verification scripts and assertions
5. Document component-specific considerations

## üìñ Additional Resources

- [OpenTelemetry Collector Documentation](https://opentelemetry.io/docs/collector/)
- [OpenTelemetry Operator](https://github.com/open-telemetry/opentelemetry-operator)
- [Chainsaw Testing Framework](https://kyverno.github.io/chainsaw/)
- [OpenTelemetry Component Registry](https://opentelemetry.io/ecosystem/registry/) 